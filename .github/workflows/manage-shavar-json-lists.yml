name: Run script on shavar-creation-lists
on: workflow_dispatch

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      max-parallel: 4
      matrix:
        python-version: [3.7]
    steps:
    - uses: actions/checkout@v2
      with:
        persist-credentials: false 
        token: ${{ secrets.GITHUB_TOKEN }}
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v1
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    - uses: actions/checkout@v3
      with:
        repository: 'mozilla-services/shavar-list-creation'
        ref: 'creat-json-tracking-protection-lists'
    - name: Modify and run the script
      run: |
        ls
        mv sample_shavar_list_creation.ini shavar_list_creation.ini

        ls
        echo "run sed"
        sed -i -e 's/_creat_latest_prod/_creation/g' lists2safebrowsing.py

        cat lists2safebrowsing.py

        echo "run script"
        python3 lists2safebrowsing.py

        mkdir shavar_json_files

        mv disconnect-entitylist.json ads-track-digest256.json base-cryptomining-track-digest256.json analytics-track-digest256.json base-fingerprinting-track-digest256.json social-track-digest256.json ads-track-digest256.json social-track-digest256.json content-track-digest256.json analytics-track-digest256.json shavar_json_files/

